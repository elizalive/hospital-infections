 <!DOCTYPE html>
 <html xmlns="http://www.w3.org/1999/xhtml">
 <head>
    
       <!-- Link to jquery.js-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

    <!-- Latest compiled and minified Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.css"> 
    
    <!-- Link to CartoDB styles -->
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.11/themes/css/cartodb.css" />

    <!-- Latest compiled and minified Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="js/script.js"></script>

    <!-- Link to CartoDB.js -->
    <script src="http://libs.cartocdn.com/cartodb.js/v3/3.11/cartodb.js"></script>



    <script>
      var sublayers = [];

      var lon,
        lat,
        total = 10;

      function updateQuery() {
      sublayers[0].set({
        sql: "SELECT * FROM hosptialsbyhac_clean",
      });
    }

      function mapToPosition(position) {
      lon = position.coords.longitude;
      lat = position.coords.latitude;
      updateQuery();
      map.setView(new L.LatLng(lat,lon), 13);
      new L.CircleMarker([lat,lon],{radius: 4}).addTo(map);
      }
      function detectUserLocation(){
        if (navigator.geolocation) {
          var timeoutVal = 10 * 1000 * 1000;
          navigator.geolocation.watchPosition(
            mapToPosition, 
            alertError,
            { enableHighAccuracy: true, timeout: timeoutVal, maximumAge: 0 }
          );
        }
        else {
          alert("Geolocation is not supported by this browser");
        }
      
        function alertError(error) {
          var errors = { 
            1: 'Permission denied',
            2: 'Position unavailable',
            3: 'Request timeout'
          };
          alert("Error: " + errors[error.code]);
        }
      }
      var lon,
          lat,
          total = 10;

      var map;

      function init(){
        // initiate leaflet map
        map = new L.Map('map', { 
          center: [35,-90],
          zoom: 5
        })

        L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
          attribution: 'Mapbox <a href="http://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>'
        }).addTo(map);
      
      var layerUrl = 'http://decodedc.cartodb.com/api/v2/viz/0e1a4690-cdbb-11e4-92eb-0e0c41326911/viz.json';

      

    cartodb.createLayer(map, layerUrl)
      .addTo(map)
      .on('done', function(layer) {
        // change the query for the first layer
        var v = cdb.vis.Overlay.create('search', map.viz, {})
                v.show();
                $('#map').append(v.render().el);
        var subLayerOptions = {
          sql: "SELECT * FROM hospitals_no_null_totalhacscore",
        }
        var sublayer = layer.getSubLayer(0);

        sublayer.set(subLayerOptions);

        sublayers.push(sublayer);
        detectUserLocation();
      }).on('error', function() {
        //log the error
      });
      }
      </script>
</head>

<body onload="init()" class="">
    <div id="main-wrapper" class="">
        <div id="main-content" class="container">
            <header class="row">
                <div class="col-md-12">
                    <h1>Find penalized hospitals near you</h1>
                        <div class="introtext">
                            <p>Let the browser find your location to see hospitals in your area. Hover over a point to learn more.</p>
                            <p> Find hospitals anywhere in the U.S. by typing a city, state or address in the search box.</p>
                        </div>
                </div>
            </header>

                <div class="row">
                        <div class="col-md-6 chart" id="map">   
                        </div>

                       <!-- <div class="col-md-6 table-responsive" id="list">

                            <script>



                                var data = [ [ 1, 2, 3 ], [ 4, 5, 6 ], [7, 8, 9 ] ];

                                var html = '<table class ="table-bordered"><thead><tr>...</tr></thead><tbody>';
                                for (var i = 0, len = data.length; i < len; ++i) {
                                    html += '<tr>';
                                    for (var j = 0, rowLen = data[i].length; j < rowLen; ++j ) {
                                        html += '<td>' + data[i][j] + '</td>';
                                    }
                                    html += "</tr>";
                                }
                                html += '</tbody><tfoot><tr>....</tr></tfoot></table>';

                                $(html).appendTo('#list');
                            </script>
                        

                       </div> -->

                </div>
        </div>
    </div>
</body>
</html>